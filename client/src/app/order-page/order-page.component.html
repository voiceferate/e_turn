  <form 
  class="card"
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
  >
  <div class="card-content">
    <span class="card-title">Реєстрація в електронній черзі</span>
    
    <div class="input-field">
      <p
        class="card-panel hoverable center-align"
        [ngClass]="{hidden: !regionRefVisible}"
        (click)=(onSelectRegion())
      >
        Обрати область
      </p>
      <div *ngIf="!regionLoading; else loader">
        <label [ngClass]="{hidden: regionRefVisible}">Оберіть область зі списку</label>
        <select 
          [ngClass]="{hidden: regionRefVisible}"
          #regionRef
          formControlName="region"
          *ngIf="regions.length !== 0 || regionRefVisible === true; else empty"
        >
          <option 
            class="blue-text text-darken-2" 
            *ngFor="let region of regions"
            [value]="region._id"
          >
            {{region.name}}
          </option>
        </select>
      </div>
    </div>

    <div class="input-field">
      <p
        class="card-panel hoverable center-align"
        [ngClass]="{hidden: !vprRefVisible}"
        (click)=(onSelectVpr())
      >
        Обрати доступний пункт реєстрації
      </p>
      <div *ngIf="!vprLoading; else loader">
        <label [ngClass]="{hidden: vprRefVisible}">Оберіть ВПР зі списку</label>
        <select 
          [ngClass]="{hidden: vprRefVisible}"
          formControlName="vpr"
          *ngIf="vprs.length !== 0 || vprRefVisible === true; else empty"

        >
          <option 
            class="blue-text text-darken-2" 
            *ngFor="let vpr of vprs"
            [value]="vpr._id"
            #vprCity
          >
          {{vpr.name}}
          </option>
        </select>
      </div>
    </div>

    <div 
      class="clientInfo"
      [ngClass]="{hidden: clientInfoRefVisible}"
    >
      <div class="input-field">
        <input 
          id="name"
          type="text"
          formControlName="name"
          [ngClass]="{'invalid': form.get('name').invalid && form.get('name').touched}"
        >
        <label for="name">Назва установи чи ПІБ ФОП:</label>
        <span 
          class="helper-text red-text"
          *ngIf="form.get('name').invalid && form.get('name').touched"  
        >
          <span *ngIf="form.get('name').errors['required']">Поле name не може бути порожнім</span>
        </span>
      </div>

      <div class="input-field">
        <input 
          ng-model
          id="customer_id_code"
          type="text"
          formControlName="customer_id_code"
          maxlength="10"
          minlength="8"
          [ngClass]="{'invalid': form.get('customer_id_code').invalid && form.get('customer_id_code').touched}"
        >
        <label for="customer_id_code">Код ЄДРПОУ або РКНОКПП:</label>
        <span 
          class="helper-text red-text"
          *ngIf="form.get('customer_id_code').invalid && form.get('customer_id_code').touched"  
        >
          <span *ngIf="form.get('customer_id_code').errors['required']">Поле customer_id_code не може бути порожнім</span>
          <span *ngIf="form.get('customer_id_code').errors['minlength']">Поле customer_id_code повинно містити від 8 до 10 цифр</span>
        </span>
      </div>
    </div>

    <p
      class="card-panel hoverable center-align"
      [ngClass]="{'hide': dateRefVisible}"
      (click)=(onSelectDate())
    >
      Обрати дату візиту
    </p>

    <div 
      class="input-field" 
      [ngClass]="{'hide': !dateRefVisible}"
    >
      <input
        #datepicker
        class="datepicker" 
        id="date"
        type="text"
        formControlName="date"
        [ngClass]="{'invalid': form.get('date').invalid && form.get('date').touched}"
      >
      <label for="date">Дата</label>
      <span 
        class="helper-text red-text"
        *ngIf="form.get('date').invalid && form.get('date').touched"  
      >
        <span *ngIf="form.get('date').errors['required']">Поле date не може бути порожнім</span>
      </span>
    </div>
    
    <div 
    class="input-field">
      <p
        class="card-panel hoverable center-align"
        [ngClass]="{'hide': orderTimeRefVisible}"
        (click)=(onSelectTime())
      >
        Обрати час візиту
      </p>

      <div 
        class="input-field" 
      >
        <div #modal class="modal">
          <div 
            class="modal-content"
            *ngIf="modalInstanse"
            >
            <app-time-select-page
              [vprId]="vprId"
              [vpr]="vprCity"
              [date]="form.controls.date.value" 
              (onSelectTimePeriod)="onSelectTimePer($event)"
            >
            </app-time-select-page>
            </div>
        </div>

        <input
          (click)=(onSelectTime())
          type="text"
          [ngClass]="{'hide': !orderTimeRefVisible}"
          formControlName="time"
          [ngClass]="{'invalid': form.get('date').invalid && form.get('date').touched}"
        >
        <label for="date">Час відвідування</label>
      </div>
    </div>

<!-- 
    <div 
    class="input-field">
      <p
        class="card-panel hoverable center-align"
        (click)=(onRunCustom())
      >
        Запустити
      </p>
    </div> -->
    

  </div>
  <div class="card-action">
    <button 
      type="submit"
      [disabled]="form.invalid || form.disabled"
      class="modal-action btn light-blue darken-4 waves-effect"
    >Ввійти</button>
  </div>
</form>


<ng-template #loader>
  <app-loader></app-loader>
</ng-template>


<ng-template #empty> 
  <div class="center">
    <p>Дані відсутні</p>
  </div>
</ng-template>